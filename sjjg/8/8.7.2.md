# 外部排序-败者树
## 解决内部归并所需时间
使用k路平衡归并策略，选出一个最小元素需要对比关键字(k-1）次，导致内部归并所需时间增加

eg：8路平衡归并，从八个归并段中选出一个最小元素需要对比关键字`7`次

## 什么是败者树？
失败者留在这一回合，胜利者进入下一回合比拼
若有8位参赛者，则构造败者树需要7次比拼

败者树—可视为一棵完全二叉树（多了一个头头）。人个叶结点分别是当前参加比较的元素，非叶子结点用来记忆左右子树中的“失败者”，而让胜者往上继续进行比较，一直到根结点。

冠军一一天津饭选手
组委会宣布：天津饭选手主动放弃冠军
由“派大星”选手顶替（天津饭原来的位置）

`不需要重新比赛，让新来的人和之前冠军的对手比赛即可`
——基于已经构建好的败者树，选出新的胜者只需进行 3场比赛

## 败者树在多路平衡归并中的应用

1、每个叶子结点对应一个归并段的一个值，构建`败者树`
2、分支结点记录失败败者来自哪个归并段 —— 这样下一个`新人`就知道要和哪个段的第一个元素打（比较大小）
3、根节点记录冠军来自哪个归并段 —— 这样知道下一个`新人`是来自哪个段

### 结论
1、对k路归井，第一次构造败者树需要对比关键字k-1次
2、有了败者树，选出最小元素，只需对比关键字`log2k 向下取整`次
（和灰色分支（失败者）的高度相同）-》第h层最多有 2^(h-1)个节点。k<=2^(h-1)个

1024路10次~

## 代码实现
k路归并的败者树只需要定义一个长度为k的数组即可

叶子结点是“虚拟的”

败者树的形状

冠军
|
失败节点（这一轮比赛的失败者来自哪里）
|
虚拟的叶子结点（各个端一一对应）

各个端